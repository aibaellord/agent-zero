/**
 * â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
 * â–ˆ                                                                          â–ˆ
 * â–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆ
 * â–ˆ   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆ
 * â–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆ
 * â–ˆ   â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆ
 * â–ˆ   â–ˆâ–ˆâ•‘     â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆ
 * â–ˆ   â•šâ•â•      â•šâ•â•â•â•â•â•  â•šâ•â•â•â•šâ•â•â• â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•    â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â–ˆ
 * â–ˆ                                                                          â–ˆ
 * â–ˆ   BAEL POWER BAR - Quick Access Floating Action Bar                     â–ˆ
 * â–ˆ   Always-accessible floating bar for rapid actions                      â–ˆ
 * â–ˆ                                                                          â–ˆ
 * â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
 */

(function () {
  "use strict";

  class BaelPowerBar {
    constructor() {
      this.version = "1.0.0";
      this.initialized = false;
      this.visible = true;
      this.minimized = false;
      this.container = null;
      this.position = { x: 20, y: window.innerHeight / 2 };
      this.isDragging = false;
    }

    async initialize() {
      console.log("âš¡ Bael Power Bar initializing...");

      this.loadPosition();
      this.injectStyles();
      this.createContainer();
      this.setupDrag();
      this.setupShortcuts();

      this.initialized = true;
      console.log("âœ… BAEL POWER BAR READY");

      return this;
    }

    injectStyles() {
      if (document.getElementById("bael-power-bar-styles")) return;

      const styles = document.createElement("style");
      styles.id = "bael-power-bar-styles";
      styles.textContent = `
                .bael-power-bar {
                    position: fixed;
                    z-index: 9500;
                    display: flex;
                    flex-direction: column;
                    gap: 6px;
                    background: rgba(26, 26, 46, 0.95);
                    backdrop-filter: blur(12px);
                    border-radius: 14px;
                    padding: 10px;
                    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4),
                                0 0 0 1px rgba(255, 255, 255, 0.1);
                    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                }

                .bael-power-bar.minimized {
                    padding: 6px;
                }

                .bael-power-bar.minimized .power-btn:not(.toggle-btn) {
                    display: none;
                }

                .bael-power-bar.hidden {
                    transform: translateX(-100px);
                    opacity: 0;
                    pointer-events: none;
                }

                .power-btn {
                    width: 44px;
                    height: 44px;
                    border-radius: 10px;
                    border: none;
                    background: rgba(255, 255, 255, 0.08);
                    color: #fff;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 20px;
                    transition: all 0.2s;
                    position: relative;
                }

                .power-btn:hover {
                    background: rgba(99, 102, 241, 0.3);
                    transform: scale(1.1);
                }

                .power-btn:active {
                    transform: scale(0.95);
                }

                .power-btn.toggle-btn {
                    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
                }

                .power-btn.toggle-btn:hover {
                    background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
                }

                .bael-power-bar.minimized .toggle-btn {
                    width: 36px;
                    height: 36px;
                    font-size: 16px;
                }

                .power-tooltip {
                    position: absolute;
                    left: calc(100% + 10px);
                    top: 50%;
                    transform: translateY(-50%);
                    padding: 6px 12px;
                    background: #1e1e2e;
                    border-radius: 6px;
                    font-size: 12px;
                    white-space: nowrap;
                    opacity: 0;
                    pointer-events: none;
                    transition: opacity 0.2s;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
                }

                .power-btn:hover .power-tooltip {
                    opacity: 1;
                }

                .power-separator {
                    height: 1px;
                    background: rgba(255, 255, 255, 0.1);
                    margin: 4px 0;
                }

                .drag-handle {
                    width: 100%;
                    height: 6px;
                    background: rgba(255, 255, 255, 0.2);
                    border-radius: 3px;
                    cursor: grab;
                    margin-bottom: 6px;
                }

                .drag-handle:active {
                    cursor: grabbing;
                }

                .bael-power-bar.minimized .drag-handle {
                    display: none;
                }
            `;
      document.head.appendChild(styles);
    }

    createContainer() {
      this.container = document.createElement("div");
      this.container.id = "bael-power-bar";
      this.container.className = "bael-power-bar";
      this.container.style.left = `${this.position.x}px`;
      this.container.style.top = `${this.position.y}px`;

      this.container.innerHTML = this.getTemplate();
      document.body.appendChild(this.container);
    }

    getTemplate() {
      const actions = [
        {
          icon: "ğŸš€",
          action: "launcher",
          tooltip: "Quick Launcher",
          shortcut: "âŒƒâŒƒ",
        },
        {
          icon: "ğŸ”",
          action: "search",
          tooltip: "Universal Search",
          shortcut: "âŒƒ/",
        },
        {
          icon: "ğŸ¯",
          action: "command",
          tooltip: "Command Center",
          shortcut: "âŒƒK",
        },
        { type: "separator" },
        { icon: "ğŸ’¬", action: "new-chat", tooltip: "New Chat", shortcut: "âŒƒN" },
        {
          icon: "ğŸ“‹",
          action: "templates",
          tooltip: "Templates",
          shortcut: "âŒƒâ‡§T",
        },
        {
          icon: "â­",
          action: "favorites",
          tooltip: "Favorites",
          shortcut: "âŒƒâ‡§B",
        },
        { type: "separator" },
        {
          icon: "ğŸ“Š",
          action: "performance",
          tooltip: "Performance",
          shortcut: "âŒƒâ‡§P",
        },
        { icon: "ğŸ§ ", action: "memory", tooltip: "Memory", shortcut: "âŒƒâ‡§M" },
        {
          icon: "ğŸ“¡",
          action: "status",
          tooltip: "System Status",
          shortcut: "âŒƒâ‡§S",
        },
        { type: "separator" },
        { icon: "âš™ï¸", action: "settings", tooltip: "Settings", shortcut: "âŒƒ," },
      ];

      let html = `
                <div class="drag-handle"></div>
                <button class="power-btn toggle-btn" onclick="BaelPowerBar.toggleMinimize()">
                    âš¡
                    <span class="power-tooltip">Toggle Power Bar</span>
                </button>
            `;

      for (const action of actions) {
        if (action.type === "separator") {
          html += '<div class="power-separator"></div>';
        } else {
          html += `
                        <button class="power-btn" onclick="BaelPowerBar.execute('${action.action}')">
                            ${action.icon}
                            <span class="power-tooltip">${action.tooltip} <small>${action.shortcut}</small></span>
                        </button>
                    `;
        }
      }

      return html;
    }

    setupDrag() {
      const handle = this.container.querySelector(".drag-handle");

      handle.addEventListener("mousedown", (e) => {
        this.isDragging = true;
        const rect = this.container.getBoundingClientRect();
        this.dragOffset = {
          x: e.clientX - rect.left,
          y: e.clientY - rect.top,
        };

        document.addEventListener("mousemove", this.onDrag.bind(this));
        document.addEventListener("mouseup", this.onDragEnd.bind(this));
      });
    }

    onDrag(e) {
      if (!this.isDragging) return;

      const x = Math.max(
        0,
        Math.min(e.clientX - this.dragOffset.x, window.innerWidth - 60),
      );
      const y = Math.max(
        0,
        Math.min(e.clientY - this.dragOffset.y, window.innerHeight - 400),
      );

      this.container.style.left = `${x}px`;
      this.container.style.top = `${y}px`;
      this.position = { x, y };
    }

    onDragEnd() {
      this.isDragging = false;
      document.removeEventListener("mousemove", this.onDrag.bind(this));
      document.removeEventListener("mouseup", this.onDragEnd.bind(this));
      this.savePosition();
    }

    setupShortcuts() {
      document.addEventListener("keydown", (e) => {
        // Ctrl+B to toggle power bar visibility
        if ((e.ctrlKey || e.metaKey) && e.key === "b" && !e.shiftKey) {
          e.preventDefault();
          this.toggleVisibility();
        }
      });
    }

    loadPosition() {
      try {
        const stored = localStorage.getItem("bael_power_bar_position");
        if (stored) {
          this.position = JSON.parse(stored);
        }
      } catch (e) {
        // Use default
      }
    }

    savePosition() {
      localStorage.setItem(
        "bael_power_bar_position",
        JSON.stringify(this.position),
      );
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ACTIONS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    execute(action) {
      switch (action) {
        case "launcher":
          window.BaelQuickLauncher?.show?.();
          break;
        case "search":
          window.BaelUnifiedSearch?.show?.();
          break;
        case "command":
          window.BaelCommandCenter?.show?.();
          break;
        case "new-chat":
          window.dispatchEvent(new CustomEvent("bael:new-chat"));
          break;
        case "templates":
          window.BaelTemplateLibrary?.show?.();
          break;
        case "favorites":
          window.BaelFavoritesHub?.show?.();
          break;
        case "performance":
          window.BaelPerformanceDashboard?.show?.();
          break;
        case "memory":
          window.BaelMemoryDashboard?.show?.();
          break;
        case "status":
          window.BaelSystemStatus?.show?.();
          break;
        case "settings":
          window.dispatchEvent(new CustomEvent("bael:open-settings"));
          break;
      }
    }

    toggleMinimize() {
      this.minimized = !this.minimized;
      this.container.classList.toggle("minimized", this.minimized);
      localStorage.setItem("bael_power_bar_minimized", this.minimized);
    }

    toggleVisibility() {
      this.visible = !this.visible;
      this.container.classList.toggle("hidden", !this.visible);
    }

    show() {
      this.visible = true;
      this.container.classList.remove("hidden");
    }

    hide() {
      this.visible = false;
      this.container.classList.add("hidden");
    }
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // INITIALIZATION
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  window.BaelPowerBar = new BaelPowerBar();

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", () => {
      window.BaelPowerBar.initialize();
    });
  } else {
    window.BaelPowerBar.initialize();
  }

  console.log("âš¡ Bael Power Bar loaded");
})();
